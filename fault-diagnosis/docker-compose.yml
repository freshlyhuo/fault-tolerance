version: '3.8'

services:
  etcd:
    image: quay.io/coreos/etcd:v3.5.11
    container_name: fault-diagnosis-etcd
    ports:
      - "2379:2379"
      - "2380:2380"
    environment:
      - ALLOW_NONE_AUTHENTICATION=yes
      - ETCD_ADVERTISE_CLIENT_URLS=http://etcd:2379
    command:
      - /usr/local/bin/etcd
      - --listen-client-urls=http://0.0.0.0:2379
      - --advertise-client-urls=http://etcd:2379
      - --listen-peer-urls=http://0.0.0.0:2380
    networks:
      - fault-diagnosis-network

  fault-diagnosis-business:
    build: .
    container_name: fault-diagnosis-business
    depends_on:
      - etcd
    command:
      - -config=/app/configs/fault_tree_business.json
      - -etcd=etcd:2379
      - -prefix=/alerts/business/
      - -log-level=info
    volumes:
      - ./configs:/app/configs
    networks:
      - fault-diagnosis-network
    restart: unless-stopped

  fault-diagnosis-microservice:
    build: .
    container_name: fault-diagnosis-microservice
    depends_on:
      - etcd
    command:
      - -config=/app/configs/fault_tree_microservice.json
      - -etcd=etcd:2379
      - -prefix=/alerts/microservice/
      - -log-level=info
    volumes:
      - ./configs:/app/configs
    networks:
      - fault-diagnosis-network
    restart: unless-stopped

networks:
  fault-diagnosis-network:
    driver: bridge
